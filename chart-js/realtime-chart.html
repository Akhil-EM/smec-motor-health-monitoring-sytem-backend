<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@0.5.7/chartjs-plugin-annotation.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@1.9.0"></script>
</head>
<body>
	<div>
		<canvas id="myChart"></canvas>
	</div>
	<p>
		0%<input type="range"  id="range">100%
	</p>
</body>

<script>
function randomScalingFactor() {
	return (Math.random() > 0.5 ? 1.0 : -1.0) * Math.round(Math.random() * 100);
}

function onRefresh(chart) {
	var now = Date.now();
	chart.data.datasets.forEach(function(dataset) {
		dataset.data.push({
			x: now,
			y: randomScalingFactor()
		});
	});
}

var color = Chart.helpers.color;
var config = {
	type: 'line',
	data: {
		datasets: [{
			label: 'Dataset 2 (cubic interpolation)',
			backgroundColor: 'rgb(54, 162, 235)',
			borderColor: 'rgb(54, 162, 235)',
			fill: false,
			// cubicInterpolationMode: 'monotone',
			data: []
		}]
	},
	options: {
		title: {
			display: true,
			text: 'Annotation plugin sample'
		},
		scales: {
			xAxes: [{
				type: 'realtime',
				realtime: {
					duration: 20000,
					refresh: 1000,
					delay: 2000,
					onRefresh: onRefresh
				}
			}],
			yAxes: [{
				scaleLabel: {
					display: true,
					labelString: 'value'
				}
			}]
		},
		tooltips: {
			mode: 'nearest',
			intersect: false
		},
		hover: {
			mode: 'nearest',
			intersect: false
		},
		annotation: {
			annotations: [
				{
					id: 'hline',
					type: 'line',
					mode: 'horizontal',
					scaleID: 'y-axis-0',
					value: 40,
					borderColor: 'rgb(255, 99, 132)',
					borderWidth: 3,
                    borderDash: [8,4],
					label: {
						backgroundColor:'rgb(255, 99, 132)',
						content: 'upper limit',
						enabled: true
					},
				},
                {
					//drawTime: 'afterDatasetsDraw',
					id: 'hline2',
					type: 'line',
					mode: 'horizontal',
					scaleID: 'y-axis-0',
					value: -40,
					borderColor: 'rgb(255, 99, 132)',
					borderWidth: 3,
                    borderDash: [8,4],
					label: {
						backgroundColor:'rgb(255, 99, 132)',
						content: 'lower limit',
						enabled: true
					},
				}
			]
		}
	}
    
};

window.onload = function() {
	var ctx = document.getElementById('myChart').getContext('2d');
	window.myChart = new Chart(ctx, config);
    window.myChart.options.annotation.annotations[0].value = 25;
    window.myChart.update();
};

const button = document.querySelector("#range");
button.addEventListener('input',function(e) {
    var value = this.value;
    // window.myChart.options.annotation.annotations[1].value = -value;
    // window.myChart.options.title.text = value;
    // window.myChart.update();
    var chart = Chart.instances[0];
    var annotation = chart.options.annotation.annotations[0];
    annotation.value = value;
    chart.update();
})

</script>

</html>